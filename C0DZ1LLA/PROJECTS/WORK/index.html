<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <title>C0DZ1LLA Systems</title>
    <style>
        /* General styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #111;
            margin: 0;
            padding: 0;
            color: #fff;
        }

        .container {
            max-width: 90%;
            margin: 20px auto;
            padding: 20px;
            background-color: #222;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        h1 {
            color: #ffd700; /* Dark gold */
            margin-bottom: 20px;
        }

        /* Dropdown menu styles */
        .select-container {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content horizontally */
        }

        select {
            appearance: none;
            padding: 12px;
            border: 1px solid #00ffff; /* Neon blue */
            border-radius: 5px;
            background-color: #333;
            color: #fff;
            font-size: 16px;
            width: 100%;
            max-width: 300px;
            cursor: pointer;
            transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease;
        }

        select:hover,
        select:focus {
            border-color: #ffd700; /* Dark gold */
            background-color: #444;
        }

        /* Label styles */
        .label-container {
            margin-bottom: 10px;
        }

        label {
            margin-bottom: 5px; /* Add some bottom margin */
            font-size: 16px;
            color: #ffd700; /* Dark gold */
            display: block; /* Ensure labels are displayed as block elements */
            text-align: center; /* Center text */
        }

        /* Button styles */
        .button-container {
            margin-top: 20px;
        }

        button {
            background-color: #00ffff; /* Neon blue */
            color: #111;
            border: none;
            border-radius: 5px;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.3s ease;
        }

        button:hover {
            background-color: #ffd700; /* Dark gold */
            color: #fff;
            transform: scale(1.05);
        }

        /* Dark theme */
        body {
            background-color: #222;
            color: #fff;
        }

        .container {
            background-color: #333;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        h1 {
            color: #ffd700; /* Dark gold */
        }

        select {
            border-color: #ffd700; /* Dark gold */
            background-color: #444;
        }

        select:hover,
        select:focus {
            border-color: #ffd700; /* Dark gold */
            background-color: #555;
        }

        label {
            color: #ffd700; /* Dark gold */
        }

        button {
            background-color: #00ffff; /* Neon blue */
            color: #111;
        }

        button:hover {
            background-color: #ffd700; /* Dark gold */
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Monthly Schedule Management</h1>
    <div class="select-container">
        <div class="label-container">
        </div>
    </div>
</div>
<div class="container">
    <div class="select-container">
        <div class="label-container">
            <label for="month-dropdown">Select Month:</label>
            <select id="month-dropdown">
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>


 
        <div class="select-container">
            <div class="label-container">
        <label for="date-number-dropdown">Select Month Date:</label>
    <select id="date-number-dropdown">
        <script>
            for (let i = 1; i <= 31; i++) {
                document.getElementById('date-number-dropdown').innerHTML += `<option value="${i}">${i}</option>`;
            }
        </script>
    </select>

<div class="label-container">

             <label for="month-dropdown">Select Day:</label>
        <select id="day-dropdown">
        <option value="Monday">Monday</option>
        <option value="Tuesday">Tuesday</option>
        <option value="Wednesday">Wednesday</option>
        <option value="Thursday">Thursday</option>
        <option value="Friday">Friday</option>
        <option value="Saturday">Saturday</option>
        <option value="Sunday">Sunday</option>
    </select>



    <div class="container">
        <label for="start-hour-dropdown">Select Start Time:</label>
            <select id="start-hour-dropdown">
                <!-- Options for start hour -->
                <script>
                    for (let i = 0; i <= 23; i++) {
                        document.getElementById('start-hour-dropdown').innerHTML += `<option value="${i}">${i}</option>`;
                    }
                </script>
                <!-- Add options for other hours -->
            </select>

            <select id="start-minute-dropdown">
                <!-- Options for start minute -->
                <script>
                    for (let i = 0; i <= 60; i++) {
                        document.getElementById('start-minute-dropdown').innerHTML += `<option value="${i}">${i}</option>`;
                    }
                </script>
                <!-- Add options for other minutes -->
        </select>
    </div>

    <div class="container">
        <label for="end-hour-dropdown">Select End Time:</label>
            <select id="end-hour-dropdown">
                <!-- Options for end hour -->
                <script>
                    for (let i = 0; i <= 23; i++) {
                        document.getElementById('end-hour-dropdown').innerHTML += `<option value="${i}">${i}</option>`;
                    }
                </script>
                <!-- Add options for other hours -->
            </select>

            <select id="end-minute-dropdown">
                <!-- Options for end minute -->
                <script>
                    for (let i = 0; i <= 60; i++) {
                        document.getElementById('end-minute-dropdown').innerHTML += `<option value="${i}">${i}</option>`;
                    }
                </script>
                <!-- Add options for other minutes -->
            </select>
    </div>

    <div class="container">
        <button onclick="addCustomMonthlySchedule()">Add Custom Monthly Schedule</button>
    </div>

    <div class="schedule" id="schedule"></div>
    <div class="container">

    <button onclick="calculateTotalHours()">Calculate Total Hours</button>
    <button onclick="clearData()">Clear Data</button>
    <button onclick="exportToCSV()">Export to CSV</button>

    <div class="footer">
        <p>Designed by <a href="https://samanconnect.com/" target="_blank">SAMAN</a></p>
    </div>
</div>

<script>
    class ScheduleDay {
    constructor(month, day, dateNumber, workStart, workEnd) {
        this.month = month;
        this.day = day;
        this.dateNumber = dateNumber; // Add dateNumber property
        this.workStart = workStart;
        this.workEnd = workEnd;
        this.totalHours = this.calculateTotalHours(workStart, workEnd);
        this.timerIntervalId = null;
        this.isTimerRunning = false;
        this.timerStartTime = null;
        this.pausedTime = 0;
        this.hoursPreview = '';
    }

    calculateTotalHours(startTime, endTime) {
        const [startHour, startMinute] = startTime.split(':').map(parseFloat);
        const [endHour, endMinute] = endTime.split(':').map(parseFloat);
        const totalHours = (endHour + endMinute / 60) - (startHour + startMinute / 60);
        return totalHours > 0 ? totalHours : 0;
    }
}


    let monthlySchedule = JSON.parse(localStorage.getItem('monthlySchedule')) || [];

    function addCustomMonthlySchedule() {
    const selectedMonth = document.getElementById('month-dropdown').value;
    const selectedDay = document.getElementById('day-dropdown').value;
    const selectedDateNumber = document.getElementById('date-number-dropdown').value; // Add this line to retrieve the selected date number
    const selectedStartHour = document.getElementById('start-hour-dropdown').value;
    const selectedStartMinute = document.getElementById('start-minute-dropdown').value;
    const selectedEndHour = document.getElementById('end-hour-dropdown').value;
    const selectedEndMinute = document.getElementById('end-minute-dropdown').value;

    const workStart = `${selectedStartHour}:${selectedStartMinute}`;
    const workEnd = `${selectedEndHour}:${selectedEndMinute}`;

    const scheduleDay = new ScheduleDay(selectedMonth, selectedDay, selectedDateNumber, workStart, workEnd); // Pass selectedDateNumber to the ScheduleDay constructor
    monthlySchedule.push(scheduleDay);

    saveScheduleToLocalStorage();
    displaySchedule();
}


    function saveScheduleToLocalStorage() {
        localStorage.setItem('monthlySchedule', JSON.stringify(monthlySchedule));
    }

    function displaySchedule() {
    const scheduleDiv = document.getElementById("schedule");
    scheduleDiv.innerHTML = "";

    monthlySchedule.forEach(day => {
        const dayDiv = document.createElement("div");
        dayDiv.classList.add("day");
        const totalTime = day.isTimerRunning ? calculateUpdatedTotalHours(day) : day.totalHours;
        dayDiv.innerHTML = `<p>${day.month} ${day.day.toUpperCase()} ${day.dateNumber}: Work Hours - ${day.workStart} to ${day.workEnd} | Total Hours - <span class="total-hours">${totalTime.toFixed(2)}</span></p>`;
        const timerDiv = document.createElement("div");
        timerDiv.classList.add("timer");
        const timerButton = document.createElement("button");
        timerButton.textContent = day.isTimerRunning ? "Pause Timer" : "Start Timer";
        timerButton.onclick = function(event) {
            toggleTimer(day, event);
        };
        const timerText = document.createElement("p");
        timerText.textContent = day.isTimerRunning ? "Hours Preview: " + day.hoursPreview : "";
        timerDiv.appendChild(timerButton);
        timerDiv.appendChild(timerText);
        dayDiv.appendChild(timerDiv);
        scheduleDiv.appendChild(dayDiv);
    });
}


    function calculateUpdatedTotalHours(day) {
        const elapsedTime = calculateElapsedTime(day);
        return day.totalHours - (elapsedTime / 3600);
    }

    function calculateTotalHours() {
        let totalHours = 0;
        monthlySchedule.forEach(day => {
            totalHours += day.isTimerRunning ? calculateUpdatedTotalHours(day) : day.totalHours;
        });
        alert(`Total Hours for the Month: ${totalHours.toFixed(2)}`);
    }

    function calculateElapsedTime(day) {
        const currentTime = new Date().getTime();
        const elapsedTime = (currentTime - day.timerStartTime) / 1000;
        const remainingTime = day.totalHours * 3600 - elapsedTime;
        const elapsedHours = (day.totalHours * 3600 - remainingTime) / 3600;
        return elapsedHours;
    }

    function toggleTimer(day, event) {
        const timerButton = event.target;
        if (!day.isTimerRunning) {
            resetHoursPreview(day);
            startTimer(day, timerButton);
        } else {
            pauseTimer(day, timerButton);
        }
    }

    function startTimer(day, timerButton) {
        day.isTimerRunning = true;
        const storedTimerData = JSON.parse(localStorage.getItem(`timer_${day.month}_${day.day}`));
        if (storedTimerData) {
            day.timerStartTime = storedTimerData.startTime;
            day.pausedTime = storedTimerData.pausedTime;
        } else {
            day.timerStartTime = new Date().getTime() - day.pausedTime;
        }
        timerButton.textContent = "Pause Timer";
        day.timerIntervalId = setInterval(function() {
            const currentTime = new Date().getTime();
            const elapsedTime = (currentTime - day.timerStartTime) / 1000;
            const remainingTime = day.totalHours * 3600 - elapsedTime;
            if (remainingTime <= 0) {
                clearInterval(day.timerIntervalId);
                timerButton.textContent = "Timer Finished";
                day.isTimerRunning = false;
                localStorage.removeItem(`timer_${day.month}_${day.day}`);
            } else {
                const hours = Math.floor(remainingTime / 3600);
                const minutes = Math.floor((remainingTime % 3600) / 60);
                const seconds = Math.floor(remainingTime % 60);
                const timerText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                timerButton.textContent = `Remaining Time: ${timerText}`;
                day.hoursPreview = timerText;
                displaySchedule();
                const updatedTotalHours = calculateUpdatedTotalHours(day);
                const dayDiv = timerButton.parentElement.parentElement;
                const totalHoursDisplay = dayDiv.querySelector(".total-hours");
                totalHoursDisplay.textContent = `${updatedTotalHours.toFixed(2)}`;
            }
        }, 1000);
    }

    function pauseTimer(day, timerButton) {
        clearInterval(day.timerIntervalId);
        timerButton.textContent = "Resume Timer";
        day.isTimerRunning = false;
        const currentTime = new Date().getTime();
        day.pausedTime += currentTime - day.timerStartTime;
    }

    function resetHoursPreview(day) {
        day.hoursPreview = '';
    }

    function clearData() {
        localStorage.removeItem('monthlySchedule');
        monthlySchedule = [];
        displaySchedule();
    }

    function exportToCSV() {
    let csvContent = "data:text/csv;charset=utf-8,";
    const header = ['Month', 'Day', 'Date Number', 'Work Start Time', 'Work End Time', 'Total Hours']; // Add 'Date Number' to the header
    csvContent += header.join(',') + '\n';
    monthlySchedule.forEach(day => {
        const totalTime = day.isTimerRunning ? calculateUpdatedTotalHours(day) : day.totalHours;
        const row = [day.month, day.day, day.dateNumber, day.workStart, day.workEnd, totalTime.toFixed(2)]; // Include 'day.dateNumber' in the row
        csvContent += row.join(',') + '\n';
    });
    const encodedURI = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedURI);
    link.setAttribute("download", "monthly_schedule.csv");
    document.body.appendChild(link);
    link.click();
}

    displaySchedule();

    // Initialize Flatpickr for time selectors
    flatpickr(".time-selector", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "H:i",
    });

    // Populate dropdowns for other hours and minutes
    const hoursDropdowns = document.querySelectorAll('select[id$="-hour-dropdown"]');
    const minutesDropdowns = document.querySelectorAll('select[id$="-minute-dropdown"]');
    populateDropdowns(hoursDropdowns, 0, 23);
    populateDropdowns(minutesDropdowns, 0, 59);

    function populateDropdowns(dropdowns, start, end) {
        dropdowns.forEach(dropdown => {
            for (let i = start; i <= end; i++) {
                const option = document.createElement('option');
                const value = i.toString().padStart(2, '0');
                option.value = value;
                option.textContent = value;
                dropdown.appendChild(option);
            }
        });
    }
</script>
</body>
</html>
